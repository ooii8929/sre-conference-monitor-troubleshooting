# How to init the lab

1. rewrite the variable tag: Owner
2. Check the variable `region` in `variables.tf` to match yours AWS Profile
2. Run script (around 20 miniutes)

```
aws configure --profile <profile>
AWS_PROFILE=<profile> ./init.sh
```

# End the lab

```
AWS_PROFILE=<profile> ./destroy.sh
```

# elasticSearch rebuild error

```
 Error: context deadline exceeded
│ 
│   with helm_release.elasticsearch
```
```
./resource-management/remove.sh
```

# set config
```
aws eks update-kubeconfig --name  monitor-troubleshooting --profile <profile>
```




## Error 

```
module.eks.module.eks_managed_node_group["ascode-cluster-wg"].aws_eks_node_group.this[0]: Creating...
╷
│ Error: creating EKS Node Group (monitor-troubleshooting:ascode-cluster-wg-20240411132747335400000001): operation error EKS: CreateNodegroup, https response error StatusCode: 400, RequestID: d024e36e-8744-4e45-9e2c-dbea0ca042a9, InvalidRequestException: You are not authorized to launch instances with this launch template. Encoded authorization failure message: UJMahXmHUI1chPt9JZTuN9ipAf3BlEaVmxRQtUnTN6zGlGtQ4yJ1uDnjoiSmYu15NQfty4Te5qujUCu7IYY4vaiJO5d5uSgLRNsCKYUInTZYXaHsQhYrl-efLOckpaHcaSts1kXit0wxwEPEvvys7WZ-PTTDVIpqz3dQjVI67-kW0CDN0l_NhNjgebVcXrIBm4Rxs59_UvOE-YhCObZHs71Nr-QClHqfr3GUEKxpDMPAtBe_iKKs9mvcDew-MEWVV1h1OoHIGN-zxJaF8SaBkikYrDVTYcIyp_3fi9nj4iJ8qIwsGnMc9n2ARBYC-hAXWho5b23ZBrwL6z6ARRnuYz80E-JtSU_8HN619CmOgag_IxLKbpsHLxPs9vMl7mQiFbfSFny5-hFGqN8HECOCueU6ntbex2y_X8TIlIO_8LQW4gHr8sgdFxO3ChZXwFMEQYq-d6CjU2uJvRWAxaDxvH-AFjPneMmTdY3QvYLxRamDPTMiNh7x79kaJrQbTN9OXI25uuWqhuU1iP4G1FpBIp7dAdVybQ7Qvw_qzbWGJkYxBmYN9WMelE0uuoljoC0MvzmFs9Ii-XYesANdo0cF9lfcOJsz7ifDP1eEusMHkc_6-26do8pxTwaZmk603WrShkzh9YIcHzxwKdd-te6lVx9FVTYb3R6UdbIP3aZEmpO_EUqu2IK1A6WnoW5Kaxfjoqh1C_jA-Z8ZrG_yLsINXjHS17v5zjk89Bcjm025t5vecOe0hvvkvmHKW7PndZnQmZpnhOo9GJvFNkKp3KfpHKRD4oM9VKWdVRZA_5Nk2LnhPnLCRm90ExGsUr33XKa1WVdrCjdNm9srxqPZdinC0HOyEKzd543QQW-E3j69MQ19xWHheUBuB3j0jSWh_jvRZLBqYCWZjCSCsbejQCHgvEVC3Z7GVE8IGOaVeFFH1V3GPmTySmXxLYHpqH4gdC9Ja5CON1JbJ5KmOOPFzX9DLGrdBpVw5DASk8Av0bfh6AY8LYuk6bjTFeU1uBo-ey_Ez7XGwWE7s3mYzCUCA-ZVO0ToiNW7zs0yPeqSU2Xp8202xxR9ke9f2wfahA_IdNugTBgsMrmIaMEHON2wMHSt1Q_-PTwVucc3hWlPvwCs5c8YZNvPJGQc4OyZUU_ZZSaSvwCW_VeMcmZns63du85knUVVEfmBn_Qet7rZrVyHDc-GUS3jtmeO1C4zT7Xo9nJXqQJm8UleDzx_F8FlWQi2C_AQTalIKSS_dtH5ri8t0bh_nFBHCe903-e-9HTIydPUfGbidW8ac6MP-psNI57NCuTh
```

## Decode the error message
``` 
aws sts decode-authorization-message --encoded-message "UJMahXmHUI1chPt9JZTuN9ipAf3BlEaVmxRQtUnTN6zGlGtQ4yJ1uDnjoiSmYu15NQfty4Te5qujUCu7IYY4vaiJO5d5uSgLRNsCKYUInTZYXaHsQhYrl-efLOckpaHcaSts1kXit0wxwEPEvvys7WZ-PTTDVIpqz3dQjVI67-kW0CDN0l_NhNjgebVcXrIBm4Rxs59_UvOE-YhCObZHs71Nr-QClHqfr3GUEKxpDMPAtBe_iKKs9mvcDew-MEWVV1h1OoHIGN-zxJaF8SaBkikYrDVTYcIyp_3fi9nj4iJ8qIwsGnMc9n2ARBYC-hAXWho5b23ZBrwL6z6ARRnuYz80E-JtSU_8HN619CmOgag_IxLKbpsHLxPs9vMl7mQiFbfSFny5-hFGqN8HECOCueU6ntbex2y_X8TIlIO_8LQW4gHr8sgdFxO3ChZXwFMEQYq-d6CjU2uJvRWAxaDxvH-AFjPneMmTdY3QvYLxRamDPTMiNh7x79kaJrQbTN9OXI25uuWqhuU1iP4G1FpBIp7dAdVybQ7Qvw_qzbWGJkYxBmYN9WMelE0uuoljoC0MvzmFs9Ii-XYesANdo0cF9lfcOJsz7ifDP1eEusMHkc_6-26do8pxTwaZmk603WrShkzh9YIcHzxwKdd-te6lVx9FVTYb3R6UdbIP3aZEmpO_EUqu2IK1A6WnoW5Kaxfjoqh1C_jA-Z8ZrG_yLsINXjHS17v5zjk89Bcjm025t5vecOe0hvvkvmHKW7PndZnQmZpnhOo9GJvFNkKp3KfpHKRD4oM9VKWdVRZA_5Nk2LnhPnLCRm90ExGsUr33XKa1WVdrCjdNm9srxqPZdinC0HOyEKzd543QQW-E3j69MQ19xWHheUBuB3j0jSWh_jvRZLBqYCWZjCSCsbejQCHgvEVC3Z7GVE8IGOaVeFFH1V3GPmTySmXxLYHpqH4gdC9Ja5CON1JbJ5KmOOPFzX9DLGrdBpVw5DASk8Av0bfh6AY8LYuk6bjTFeU1uBo-ey_Ez7XGwWE7s3mYzCUCA-ZVO0ToiNW7zs0yPeqSU2Xp8202xxR9ke9f2wfahA_IdNugTBgsMrmIaMEHON2wMHSt1Q_-PTwVucc3hWlPvwCs5c8YZNvPJGQc4OyZUU_ZZSaSvwCW_VeMcmZns63du85knUVVEfmBn_Qet7rZrVyHDc-GUS3jtmeO1C4zT7Xo9nJXqQJm8UleDzx_F8FlWQi2C_AQTalIKSS_dtH5ri8t0bh_nFBHCe903-e-9HTIydPUfGbidW8ac6MP-psNI57NCuTh" |jq -r .DecodedMessage | jq
```